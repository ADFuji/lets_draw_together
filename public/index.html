<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/main.css">
    <title>Document</title>
</head>
<body>
    <div></div>
    <span id=coords style="position: absolute; top: 510px;">...</span>
    <section id="colors" style="position: fixed; z-index: 999;">
        <input type="range" id="thickness" name="points" min="1" max="100">
        <input type="color" id="color" name="color">
    </section>
    <section id="brushs">
        <span id="button_brushs_grab">Grab me</span>
        <ul>
            <li><a id="regular">Reg</a></li>
            <li><a id="exponential">Exp</a></li>
            <li><a id="move">Move(dont work)</a></li>
        </ul>
    </section>
    <div id="zoom_canvas"><canvas id="lets_draw" width="100" height="100" style="position: relative;z-index:2;"></canvas></div>
</body>
<script src="./scripts/window.js"></script>
<script src="./scripts/brushs.js"></script>
<script src="./scripts/draw.js"></script>
<script src="./scripts/colors.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    var socket = io()


    function rdraw(pre, now){
        if(pre!=now){
            ctx.beginPath();
            ctx.lineCap = 'round';
            ctx.miterLimit=1
            ctx.moveTo(pre[0], pre[1])
            //ctx.arc(mouse.offsetX, mouse.offsetY, ctx.thickness/2, 0, 2 * Math.PI);
            ctx.lineTo(now[0], now[1]);
            ctx.lineWidth=ctx.thickness
            ctx.fill();
            ctx.stroke()
        }
    }
    function expdraw(now){
        ctx.lineWidth=1
        i+=1.5
        ctx.beginPath();
        ctx.arc(now[0], now[1], 1+i, 0, 2 * Math.PI);
        ctx.stroke();
    }

    socket.on('new points', (data) => {
        console.log(data)
        let backup = {color: ctx.fillStyle, thickness: ctx.thickness}
        ctx.fillStyle = data.color
        ctx.strokeStyle = data.color
        ctx.lineWidth = data.thickness
        ctx.thickness = data.thickness
        data.dots.forEach((dot)=>{
            switch(data.function){
                case("Rdraw"):rdraw(dot[0], dot[1]);break;
                case("Expdraw"):expdraw(dot[1]);break;
            }
            
        })
        i=0
        ctx.fillStyle = backup.color
        ctx.strokeStyle = backup.color
        ctx.lineWidth = backup.thickness
        ctx.thickness = backup.thickness

    })


    fetch("/dots")
      .then(data => {
        return data.json();
      })
      .then(json => {
          json.map(data => {
            let backup = {color: ctx.fillStyle, thickness: ctx.thickness}
        ctx.fillStyle = data.color
        ctx.strokeStyle = data.color
        ctx.lineWidth = data.thickness
        ctx.thickness = data.thickness
        data.dots.forEach((dot)=>{
            switch(data.function){
                case("Rdraw"):rdraw(dot[0], dot[1]);break;
                case("Expdraw"):expdraw(dot[1]);break;
            }
            
        })
        i=0
        ctx.fillStyle = backup.color
        ctx.strokeStyle = backup.color
        ctx.lineWidth = backup.thickness
        ctx.thickness = backup.thickness
        });
      });
</script>
</html>